#!/usr/bin/env zsh

# Gemini command proxy function.
# Checks for @google/gemini-cli package and installs if needed.
# Acts as transparent proxy to the actual gemini command.

# shellcheck source=../lib/_common_proxy_lib
source "${0:A:h}/../lib/_common_proxy_lib" 2>/dev/null || {
    echo "Error: Could not load common proxy library." >&2
    return 1
}

# Main gemini function - this gets redefined to be the actual function.
gemini() {
    local gemini_pkg="@google/gemini-cli"
    
    if ! _common_check_nodejs_version 20 "gemini"; then
        return 1
    fi
    
    if ! _common_is_installed "$gemini_pkg"; then
        if _common_prompt_install "$gemini_pkg"; then
            if ! _common_install_package "$gemini_pkg"; then
                echo "Installation failed. Exiting." >&2
                return 1
            fi
        else
            echo "Installation declined. Exiting."
            return 0
        fi
    fi

    # Run the actual gemini command with all passed arguments and handle errors
    _common_run_command "gemini" "$@"
}

# Run the function with the current arguments.
gemini "$@"